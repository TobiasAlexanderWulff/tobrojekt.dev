---
import "~/styles/global.css";
import LangToggle from "~/components/LangToggle.astro";
import type { Locale, LocalizedValue } from "~/lib/i18n";
import {
  getDictionary,
  localizePath,
  resolveLocale,
  resolveLocalizedValue,
} from "~/lib/i18n";

type BaseProps = {
  title?: LocalizedValue<string>;
  description?: LocalizedValue<string>;
};

const props = Astro.props as BaseProps;
const locale: Locale = resolveLocale(Astro.currentLocale);
const dictionary = getDictionary(locale);

const resolvedTitle =
  resolveLocalizedValue(props.title, locale) ?? `${dictionary.site.name}`;
const resolvedDescription =
  resolveLocalizedValue(props.description, locale) ?? dictionary.site.description;

const navLinks = [
  {
    href: localizePath("/projects", locale),
    label: dictionary.nav.projects,
  },
  {
    href: localizePath("/tags", locale),
    label: dictionary.nav.tags,
  },
];

const searchHref = localizePath("/search", locale);
const pathname = Astro.url.pathname;
const currentYear = new Date().getFullYear();
---
<html lang={locale} class="h-full bg-white text-slate-900">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{resolvedTitle}</title>
    <meta name="description" content={resolvedDescription} />
    <link rel="icon" href="/favicon.ico" />
  </head>
  <body class="min-h-screen flex flex-col">
    <header class="border-b">
      <nav class="container flex items-center gap-4 py-4">
        <a href={localizePath("/", locale)} class="font-semibold">
          {dictionary.site.name}
        </a>
        {navLinks.map((link) => (
          <a href={link.href} class="text-slate-600 hover:text-slate-900">
            {link.label}
          </a>
        ))}
        <a href={searchHref} class="ml-auto text-slate-600 hover:text-slate-900">
          {dictionary.nav.search}
        </a>
        <LangToggle class="ml-3" locale={locale} pathname={pathname} />
      </nav>
    </header>
    <main class="flex-1">
      <slot />
    </main>
    <footer class="border-t">
      <div class="container py-6 text-sm text-slate-600">
        Â© {currentYear} Tobias Wulff. {dictionary.footer.rights}
      </div>
    </footer>
  </body>
  
</html>
